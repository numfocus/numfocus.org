---
import Container from '@components/Container.astro';
import ProjectsLayout from '@layouts/ProjectsLayout.astro';
import ProjectGrid from '@components/ProjectGrid/ProjectGrid';
import Hero from '@components/Hero.astro';
import getPageHero from '@utils/getPageHero';
import { getCollection } from 'astro:content';
import { readSingleton } from '@directus/sdk';

import directus from '../../lib/directus';
import type { LocalProject } from 'env';
import projectsSchema from "../data/projects/projects.schema.json";

const projects: LocalProject[] = await getCollection('projects');

const global = await directus.request(readSingleton('General'));

const { features, industries, languages, type } = projectsSchema.properties;

const filterOptions = { 
  features: features.items.enum,
  industries: industries.items.enum,
  languages: languages.items.enum,
  type: type.enum,
};

const pageHero = await getPageHero('projects');
---

<ProjectsLayout
  title={`Projects | ${global.site_name} - ${global.site_subheader}`}
>
  <Hero pageHero={pageHero} />
  <Container>
    <ProjectGrid {filterOptions} {projects} client:load />
  </Container>
</ProjectsLayout>