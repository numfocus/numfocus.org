---

import Container from '@components/Container.astro';
import Layout from '../layouts/Layout.astro';
import directus from '../../lib/directus';
import { readSingleton } from '@directus/sdk';
import Hero from '@components/Hero.astro';
import getPageContent from '@utils/getPageContent';
import getPageHero from '@utils/getPageHero';
import BodyContent from '@components/TipTapRender/BodyContent';
import { TipTapRender } from '@components/TipTapRender/TipTapRender';
import type { TipTapNode } from '@components/TipTapRender';


interface Props {
  title: string;
}

const global = await directus.request(readSingleton('General'));

const slug = Astro.routePattern.substring(1);

const pageHero = await getPageHero(slug);
const pageContent = await getPageContent(slug);

---

<Layout
  title={`${pageHero.title} | ${global.site_name} - ${global.site_subheader}`}
>
  <Hero pageHero={pageHero} />
  {pageContent && (
    <div>
      <TipTapRender handlers={BodyContent} node={pageContent as TipTapNode} />
    </div>
  )}

  <Container />
</Layout>
