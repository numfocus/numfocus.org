---
import { getImage } from "astro:assets";
import Container from '@components/Container.astro';
import Hero from '@components/Hero.astro';
import PersonGrid from '@components/PersonGrid/PersonGrid'
import { readItems, readSingleton } from '@directus/sdk';
import BaseLayout from '@layouts/BaseLayout.astro';
import getAssetUrl from "@utils/getAssetUrl";
import getPageHero from '@utils/getPageHero';
import getPageSeo from '@utils/getPageSeo';
import directus from '../../lib/directus';

const people = await directus.request(readItems('people'));

const global = await directus.request(readSingleton('General'));

const pageHero = await getPageHero('people');
const pageSeo = await getPageSeo('people');

const imagePromises = people.map(({ image, ...rest }) => {
  return new Promise((resolve) => {
    getImage({src: getAssetUrl(image), width: 200, height: 200 }).then(fetchedImage => (
      resolve({
        image: fetchedImage,
        ...rest
      })
    ))
  })
})

const peopleWithImages = await Promise.all(imagePromises)

---

<BaseLayout
  title={`${pageHero.title} | ${global.site_name} - ${global.site_subheader}`}
  seo={pageSeo}
>
  <Hero pageHero={pageHero} />
  <PersonGrid people={peopleWithImages} client:load />
</BaseLayout>
