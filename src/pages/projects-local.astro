---
import Container from '@components/Container.astro';
import ProjectsLayout from '@layouts/ProjectsLayout.astro';
import ProjectGrid from '@components/ProjectGrid/ProjectGrid';
import Hero from '@components/Hero.astro';
import getPageHero from '@utils/getPageHero';
import { getCollection, getEntry } from 'astro:content';
import { Markdown } from '@astropub/md';
import { Image } from 'astro:assets';
import type {
  Feature,
  Industry,
  Language,
  Project,
  ProjectFilterOptions,
} from 'env';

import directus from '../../lib/directus';
import { readItems, readSingleton } from '@directus/sdk';
import { MoveDiagonal, Link2, Star } from 'lucide-react';
import { twMerge } from 'tailwind-merge';

const localProjects = await getCollection('projects');

const footerDefaultStyle = `flex h-12 w-full place-items-center border justify-center gap-2`;

console.log(localProjects);

const global = await directus.request(readSingleton('General'));
const projects = await directus.request<Project[]>(
  readItems('projects', {
    fields: [
      '*',
      {
        languages: ['project_languages_id'],
        features: ['project_features_id'],
        industries: ['project_industries_id'],
      },
    ],
  })
);
const features = await directus.request<Feature[]>(
  readItems('project_features')
);
const industries = await directus.request<Industry[]>(
  readItems('project_industries')
);
const languages = await directus.request<Language[]>(
  readItems('project_languages')
);

const filterOptions = { features, industries, languages };

const pageHero = await getPageHero('projects');
---

<ProjectsLayout
  title={`Projects | ${global.site_name} - ${global.site_subheader}`}
>
  <Hero pageHero={pageHero} />
  <Container>
    <div class="project-grid mb-64 grid grid-cols-12 gap-8">
      {
        localProjects.map((project) => (
          <div class="project-card border-numfocus-primary flex flex-col justify-between border col-span-4">
            <div class="relative h-12 w-full">
              <div class="absolute top-0 right-0 flex cursor-pointer place-items-center gap-2 bg-teal-600 p-2 text-white hover:bg-teal-700">
                Expand
                <MoveDiagonal className="inline" />
              </div>
            </div>
            <div class="flex flex-wrap overflow-hidden px-4 py-5 sm:p-6 min-h-120">
              <h5 class="pt-8 block w-full">{project.data.name}</h5>
              <Image
                src={project.data.logo}
                alt={project.data.name}
                class="mx-auto my-0 h-42 w-auto"
              />
              <p class="text-center text-sm">
                <Markdown.Inline of={project.data.short_description} />
              </p>
              {/* <a href={project.website_link}>{project.website_link}</a> */}
            </div>
            {project.data.type === 'affiliated' && (
              <div
                class={twMerge(
                  footerDefaultStyle,
                  `bg-light-teal-50 border-t-numfocus-primary text-numfocus-primary`
                )}
              >
                <Link2 />
                Affiliated Project
              </div>
            )}
            {project.data.type === 'sponsored' && (
              <div
                class={twMerge(
                  footerDefaultStyle,
                  `border-t-yellow-700 bg-yellow-50 text-yellow-700`
                )}
              >
                <Star />
                Sponsored Project
              </div>
            )}
          </div>
        ))
      }
    </div>
  </Container>
</ProjectsLayout>
