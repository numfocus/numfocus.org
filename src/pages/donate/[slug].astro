---
import { Image } from 'astro:assets';
import directus from '@directus/directus';
import { readItems, readSingleton } from '@directus/sdk';
import PageLayout from '@layouts/PageLayout.astro';

const global = await directus.request(readSingleton('General'));

import { getCollection } from 'astro:content';

const cmsProjects = await directus.request(
	readItems('projects_sync', {
		limit: -1,
	})
);

export async function getStaticPaths() {
	const projects = await getCollection('projects');

	return projects.map((project) => ({
		params: {
			slug: project.id,
		},
		props: { project },
	}));
}

const { project } = Astro.props;
const { name, logo, short_description } = project.data;

const currentProject = cmsProjects.find((val) => val.id === Astro.params.slug);

const donateUrl = `https://app.hubspot.com/payments/${currentProject?.donateLink ? currentProject.donateLink : global.donate_code}?referrer=PAYMENT_LINK_EMBED&layout=embed-full`;
---

<PageLayout
	title={`Donate to ${name} | ${global.site_name} - ${global.site_subheader}`}
	seo={{
		title:
			`Donate to ${name} | ${global.site_name} - ${global.site_subheader}` ||
			`${global.site_name} - ${global.site_subheader}`,
		meta_description: short_description || '',
		og_image: logo.src || '',
	}}
>
	<div class="grid grid-cols-2">
		<div
			class="mt-12 col-span-2 md:col-span-1 mx-auto w-2/3 flex flex-col items-center-safe md:items-baseline"
		>
			<div class="w-1/3 md:w-2/3">
				<Image src={logo} alt={`${name} logo`} />
			</div>
			<h2
				class="my-3 text-xl font-semibold text-gray-900 group-hover:text-gray-600"
			>
				Donate to {name}
			</h2>
		</div>
		<div class="col-span-2 md:col-span-1">
			<div class="payments-iframe-container h-full" data-src={donateUrl} }>
			</div>
			<script
				is:inline
				type="text/javascript"
				src="https://static.hsappstatic.net/payments-embed/ex/PaymentsEmbedCode.js"
			></script>
		</div>
	</div>
</PageLayout>
