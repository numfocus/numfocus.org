---
import { Search } from 'lucide-react';
import { Icon } from 'astro-icon/components';
import directus from '../../lib/directus';
import { readItems } from '@directus/sdk';
import type { MenuItem } from 'env';
import { twMerge } from 'tailwind-merge';
import { NavMenu, HamburgerMenu } from '@components/Atoms/Menus';
import Container from './Container.astro';
import Button from '@components/Atoms/Button';
import type { Button as but } from 'env';
import CommandPalette from '@components/CommandPalette';

const menu = await directus.request(
  readItems('Menus', {
    filter: { menu_name: { _eq: 'Navigation' } },
    fields: ['id', 'menu_name', 'item.item.*'],
  })
);
const itemsFromMenu = menu[0].item;

const menuItems: MenuItem[] = [];

for (const item of itemsFromMenu) {
  const singleItem: MenuItem = {
    title: item.item.title,
    path: `/${item.item.slug}`,
  };
  menuItems.push(singleItem);
}

const currentPage = Astro.routePattern;

const button: but = {
  text: 'Donate',
  link: 'donate',
  variant: 'donate',
};
---

<header class="border-0 border-b-[1px] border-teal-500">
  <Container>
    <div class="py-8 flex items-center justify-between gap-4">
      <a class="logo" aria-label="home" href="/">
        <Icon name="logo" class="text-5xl" />
      </a>
      <NavMenu menuItems={menuItems} currentPage={currentPage} />
      <div class="inline-flex gap-2 items-center">
        <CommandPalette client:load />
        <Button button={button} icon="heart" />
        <HamburgerMenu
          menuItems={menuItems}
          currentPage={currentPage}
          client:load
        />
      </div>
    </div>
  </Container>
</header>
